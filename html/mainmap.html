<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="../css/maps_main.css">
    <!-- geocoding style -->
        <link
    rel="stylesheet"
    href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css"
    type="text/css"
    />

    <style>

    </style>

  </head>

  <body>

    <div id='map' class='map pad2'></div>
    <!-- <div  class='sidebar pad2'><h2>Mismatch Distribution</h2><div id='pd'><p>Click a Street</p></div></div> -->
    <!-- <div  class='sidebar pad2'>
        <h2>Mismatch Distribution</h2><div id='pd'><p>Click a Street</p></div></div> -->


    
 <!-- geocoding search and side bar -->

    <aside class="as-sidebar as-sidebar--right collapse-in-onboarding" data-name="Controls">
        <div class="as-container as-container--scrollable js-scroll">
            <section class="as-box" id="search-container">
                <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>


            </section>
            <section class="as-box" id="legend">
                <!-- legend -->
            <div class="legend legend-panel js-legend hide-in-onboarding">
                <div class="widgets-item legend-inner as-box">
                    <h2 class="as-body as-font--medium legend-text">Mismatch Index</h2>
                    <div class="mismatch-legend"></div>
                    <div class="labels-legend">
                        <span class="as-caption">Offline</span>
                        <span class="as-caption">Online</span>
                    <!-- </div> -->
                </div>
            </div>
            </section>

            <section  class="as-box" >

            <!-- <label>Select layer</label> -->
            
                <select id="layer" onchange = "switchStyle()">
                
                    <div class="dropdown-content">
                    <option value="mismatch">Mismatch Index</option>
                    <option value="offline">Offline Visit</option>
                    <option value="online">Online Visit</option></div>
                
                </select>
            

            </section>
                </div>  
            </div> 

            
        </div>
    </aside>




  <!-- Promise polyfill script required to use Mapbox GL Geocoder in IE 11 -->
  <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>

  <script>
    var hoveredstreetId = null;

    mapboxgl.accessToken = 'pk.eyJ1IjoiYnJvb2tlZnp5IiwiYSI6ImNqdWFtZHNmdTA0N3o0M21oZG9peDU2NXMifQ.fbFnwmA72jGPO8IHcfEeRA';

    var map = new mapboxgl.Map({
      container: 'map', // container id
      style: 'mapbox://styles/brookefzy/cka1yguhe01of1jqharhr7bei' // replace this with your style URL
    });


// helperfunctions//
function percentNumber(num) {
    num=num*100
    return num.toFixed(2)+'%'

}

function percentNumvisit(num) {
    num=(Math.log(num+1))/13.4*100
  return num.toFixed(2)+'%'
}

function percentNumpre(num) {
    if (num>13.4){
        num=100;
    }else{
        num =(num)/13.4*100
    }
  return num.toFixed(2)+'%'
}
function svgbar1(num){
    width =(Math.log(num+1))/13.4*120
    return '<svg width="120px" height="10px"><rect x="2" y="1" width="'+width+'" height="10" style="fill:#c22e01;"/></svg>'
}

function svgbar2(num){
    if (num>13.4){
        width=120;
    }else{
        width =(num)/13.4*120
    }

    return '<svg width="120px" height="10px"><rect x="2" y="1" width="'+width+'" height="10" style="fill:#00939c;"/></svg>'
}

      map.on('click','Mismatch Index', function(e) {
        // var cbgs = map.queryRenderedFeatures(e.point,{
        //   layers:['rdof-group']
        // });
        console.log(e.features[0].properties.total_visit_quantile)
          new mapboxgl.Popup()
          .setLngLat(e.lngLat)
          .setHTML(
            '<h3>Street Name:</h3><h2><strong>'+e.features[0].properties.st_label+'</strong></h2>'+
            '<h3>Offline: '+svgbar1(e.features[0].properties.total_visit)+
                // percentNumvisit(e.features[0].properties.total_visit)+'</h3>'+
            '<h3>Online: '+svgbar2(e.features[0].properties.logvisit_predict)+///////////need adjustment
                // percentNumpre(e.features[0].properties.logvisit_predict)+'</h3>'+
                '<h4><strong>'+
             percentNumber(e.features[0].properties.mismatch_reshape)+'</strong></h4>'+
             '<h3>Mismatch Index:</strong></h3>'
        )
          .addTo(map);
          });



          // Change the cursor to a pointer when the mouse is over the states layer.
          map.on('mouseenter', 'Mismatch Index', function() {
          map.getCanvas().style.cursor = 'pointer';
          });

          // Change it back to a pointer when it leaves.
          map.on('mouseleave', 'Mismatch Index', function() {
          map.getCanvas().style.cursor = '';
          });


            map.addControl(
            new MapboxGeocoder({
            accessToken: mapboxgl.accessToken,
            mapboxgl: mapboxgl
            }));
        



            // console.log(layerId)
            function switchStyle(){
                var selstyle = document.getElementById("layer");
                var layerId = selstyle.value;

                if(layerId=="offline"){
                console.log(layerId)
                map.setStyle('mapbox://styles/brookefzy/cka34gg5f024q1ipfokjck4u2');

            }else if(layerId=="online"){

                map.setStyle('mapbox://styles/brookefzy/cka34ksar02bw1iqqwwofy3os')
            }else if (layerId=="mismatch"){
                map.setStyle('mapbox://styles/brookefzy/cka1yguhe01of1jqharhr7bei');
            }
            
            }
            
            
            


            // for (var i = 0; i < inputs.length; i++) {
            // inputs[i].onclick = switchLayer;
            // console.log(layer.value)

            // }


  </script>



  </body>

</html>
